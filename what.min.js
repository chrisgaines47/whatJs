const whatJs={isInsert:e=>["string","boolean","number"].includes(typeof e),addChild:(e,t)=>whatJs.isInsert(t)?e.insertAdjacentHTML("beforeend",t):e.appendChild(t),isObject:e=>"object"==typeof e&&!Array.isArray(e),dom:new Proxy({registry:new Map},{get:(e,t)=>(n={},r=[],i={})=>{if("register"===t)return e.registry.set(n.name,n);if(t in Object.getOwnPropertyDescriptors(e))return e[t];var s=document.createElement(t);if(n instanceof Array||n instanceof Element||whatJs.isInsert(n)?(i=r,r=n):Object.keys(n).filter(e=>!["disabled","checkbox"].includes(e)).forEach(e=>s.setAttribute(e,n[e])),e.registry.has(t))return s.appendChild(e.registry.get(t)(r,i)).parentElement;for(let o in Array.isArray(r)?r.forEach(e=>whatJs.addChild(s,e)):whatJs.addChild(s,r),i)s.addEventListener(o,e=>i[o](e,s));return s}}),context:new Proxy({_contexts:{}},{get:function(e,t){e._contexts[t]??=new Proxy({name:t,actions:new Map,data:{},expose:(e,t,r={})=>n.actions.set(e,{fn:t,data:r})||(()=>{n.actions.delete(e)}),utilize:(e,t)=>n.actions.get(e)??[...n.actions.keys()].filter(n=>n.includes(e)&&!n.includes(t)).map(e=>n.actions.get(e))},{get(e,t){if(t in e)return e[t];let{fn:n,data:r}=e.actions.get(t);return n?new Proxy(n,{apply:(e,t,i)=>"function"==typeof i[0]?i[0].apply({},[n,r]):n.apply({},[...i,r])}):Reflect.get(...arguments)}});let n=e._contexts[t];return n}}),model:new Proxy({_models:{},_makeModel:function(e,t={},n=!1){let r=n,i=new Map;function s(e,t,n=""){let r=[];if(Array.isArray(t)&&e.forEach((e,i)=>r.push(...s(e,t[0],n+`[${i}]`))),whatJs.isObject(e))for(let i in t){if(!i in e)continue;let o=n+"."+i;"function"==typeof t[i]?t[i](e[i],e)||r.push(o.substring(1)):r.push(...s(e[i],t[i],o))}return r}return new Proxy(e,{get:function(e,n,o){if("dirty"===n)return()=>r=structuredClone(e);if("clean"===n)return()=>r=!1;if("_dirty"===n)return r;if("subscribe"===n)return(e,t)=>i.set(e,t);if("validate"===n)return (n=!1)=>{if(!r)return!n||Promise.resolve(!0);let i=s(r,t);if(!i.length){for(let o in r)e[o]=r[o];r=!1}return n?i.length?Promise.reject(i):Promise.resolve(!0):!i.length||i};let a=Reflect.get(e,n,o);return"object"==typeof a?whatModel._makeModel(a,t?.[n]||{},r?.[n]):a},set:function(e,n,o){if(r&&(r[n]=o),"schema"===n&&(t=o),r||"schema"===n)return!0;if("object"==typeof t?.[n]){let a=s(o,t[n]);if(a.length)throw Error(JSON.stringify(a))}else if("function"==typeof t?.[n]&&!t[n](o,e))throw Error(n);let l=Reflect.set(e,n,o);for(let[f,c]of i.entries())c({model:e,key:n,value:o});return"object"==typeof l?whatModel._makeModel(l,t?.[n]||{}):l}})}},{get:function(e,t){return t.startsWith("_")?e[t]:t in e._models&&e._models[t]},set:function(e,t,n){e._models[t]=e._makeModel(n)}})};